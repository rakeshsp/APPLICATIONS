const anatomySections = [
  {
    key:'bone',
    title:'Bone & Marrow',
    bullets:[
      'Assess for bone contusions or marrow edema.',
      'Check for fractures or subcortical cysts.',
      'Evaluate subchondral marrow signal for insufficiency injuries.',
      'Look for cortical irregularities or osteophytes.'
    ]
  },
  {
    key:'cartilage',
    title:'Articular Cartilage',
    bullets:[
      'Evaluate patellofemoral, medial, and lateral compartments.',
      'Grade chondral lesions (Outerbridge I–IV).',
      'Identify delamination or full-thickness defects.',
      'Assess subchondral signal and adjacent bone marrow reaction.'
    ]
  },
  {
    key:'menisci',
    title:'Menisci',
    bullets:[
      'Identify intrasubstance signal vs surface-reaching tears.',
      'Define tear morphology (vertical, horizontal, radial, complex).',
      'Check posterior horn and root attachments.',
      'Evaluate extrusions or parameniscal cyst formation.'
    ]
  },
  {
    key:'ligaments',
    title:'Ligaments',
    bullets:[
      'ACL: Assess continuity, fiber orientation, edema, pivot-shift pattern.',
      'PCL: Evaluate integrity, thickness, contusion patterns.',
      'MCL/LCL: Grade sprain severity, identify fiber discontinuity.',
      'Assess posterolateral corner structures.'
    ]
  },
  {
    key:'extensor',
    title:'Extensor Mechanism',
    bullets:[
      'Patellar tendon integrity and signal abnormalities.',
      'Quadriceps tendon tears or tendinosis.',
      'Assess patellar tracking / tilt / height.',
      'Evaluate retinacula & MPFL.'
    ]
  },
  {
    key:'effusion',
    title:'Joint Effusion & Synovium',
    bullets:[
      'Estimate joint effusion volume.',
      'Identify synovial thickening or enhancement patterns.',
      'Evaluate Baker’s cyst or other bursae.',
      'Look for loose bodies or synovitis.'
    ]
  },
  {
    key:'soft',
    title:'Soft Tissues',
    bullets:[
      'Assess edema in adjacent soft tissues.',
      'Evaluate Hoffa’s fat pad for impingement signs.',
      'Identify popliteal neurovascular bundle abnormalities.',
      'Check periarticular bursae and cystic formations.'
    ]
  }
];

// Build detailed collapsible sections
function createAnatomyUI() {
  const container = document.getElementById('anatomySections');
  container.innerHTML = '';

  anatomySections.forEach(sec=>{
    checklistState[sec.key] = {finding:'not-assessed', note:''};

    const wrapper = document.createElement('div');
    wrapper.className = 'section';

    wrapper.innerHTML = `
      <div class="collapsible-title" data-anat="${sec.key}">
        <strong>${sec.title}</strong>
        <span class="muted">Click to expand</span>
      </div>

      <div id="anat-${sec.key}" style="display:none; padding:10px 6px" class="muted">

        <ul style="margin:0 0 12px 16px; padding:0;">
          ${sec.bullets.map(b=>`<li>${b}</li>`).join('')}
        </ul>

        <div class="row">
          <select data-key="${sec.key}">
            <option value="normal">Normal</option>
            <option value="abnormal">Abnormal</option>
            <option value="not-assessed" selected>Not Assessed</option>
          </select>

          <input data-note="${sec.key}" type="text" placeholder="Optional note…" />
        </div>

      </div>
    `;

    container.appendChild(wrapper);
  });

  // toggle listeners
  document.querySelectorAll('[data-anat]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = "anat-" + btn.dataset.anat;
      const el = document.getElementById(id);
      const visible = el.style.display !== 'none';
      el.style.display = visible ? 'none' : 'block';
    });
  });
}

createAnatomyUI();

